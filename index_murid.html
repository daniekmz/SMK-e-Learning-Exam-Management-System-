<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PENGUMPULAN TUGAS & MATERI</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="apple-touch-icon" sizes="180x180" href="gambar/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="gambar/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="gambar/favicon-16x16.png">
    <link rel="manifest" href="gambar/site.webmanifest">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/link-preview-js@2.1.15/dist/linkPreview.min.js"></script>
</head>
<body class="dark-mode">
    <div class="school-theme-bg"></div>
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <img src="gambar/favicon-32x32.png" alt="School Logo" class="school-logo">
                <div class="logo-text">
                    <span class="school-name">SMK Veteran 1 Sukoharjo</span>
                    <span class="school-motto">Bersatu Maju Nomer 1</span>
                </div>
            </div>
            <div class="header-center">
                <h1> Tugas,  Materi Dan Soal </h1>
                <div class="class-info">
                    <span>Tahun Ajaran 2025/2026</span>
                </div>
            </div>
            <div class="user-controls">
                <button id="theme-toggle" class="btn-icon">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </header>

<nav class="student-nav">
    <div class="nav-container">
        <button class="nav-btn active" id="tugas-btn">
            <i class="fas fa-tasks"></i> Tugas
        </button>
        <button class="nav-btn" id="soal-btn">
            <i class="fas fa-question-circle"></i> Ujian/Soal
        </button>
        <button class="nav-btn" id="soal-btn">
            <i class="coming-soon-badge"></i> New Feature will be available soon✨
        </button>
    </div>
</nav>

    <main class="main-content" id="tugas-section">
        <div class="file-manager-container">
            <!-- File Manager Header -->
            <div class="file-manager-header">
                <div class="breadcrumb">
                    <div id="breadcrumb-path"></div>
                </div>
                <div class="file-actions-header">
                    <button id="upload-file-btn" class="btn primary">
                        <i class="fas fa-upload"></i> Unggah Tugas
                    </button>
                </div>
            </div>

            <!-- Upload Box -->
            <div class="upload-box" id="drop-zone" style="display: none;">
                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                <p class="upload-text">Seret & lepas file tugas atau <span class="browse-link">cari file</span></p>
                <input type="file" id="file-upload" multiple>
                <div class="upload-progress">
                    <div class="progress-bar"></div>
                    <span class="progress-text">0%</span>
                </div>
                <div class="upload-tips">
                    <i class="fas fa-lightbulb"></i> Format file: PDF, DOCX, PPTX, ZIP (Maks. 10MB)
                </div>
            </div>

            <!-- File List -->
            <div id="file-list" class="file-list">
                <!-- Files and folders will be loaded here -->
            </div>
        </div>
    </main>

            <div class="exam-list" id="exam-list">
                <!-- Exams will be loaded here -->
                <div class="no-exams">
                    <i class="fas fa-clipboard-question"></i>
                    <p>Tidak ada ujian yang tersedia saat ini</p>
                </div>
            </div>
        </div>
    </main>
    

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-logo">
                <img src="gambar/favicon-32x32.png" alt="School Logo" class="school-logo-small">
                <div class="footer-school-info">
                    <p>SMK Veteran 1 Sukoharjo</p>
                    <p>Jl. Calen 1, Sukoharjo, Jawa Tengah</p>
                </div>
            </div>
            <div class="footer-links">
                <a href="#"><i class="fas fa-envelope"></i> Kontak</a>
                <a href="#"><i class="fas fa-info-circle"></i> Tentang</a>
                <a href="#"><i class="fas fa-shield-alt"></i> Kebijakan</a>
            </div>
        </div>
        <div class="footer-copyright">
            <p>&copy; 2025 SMK Veteran 1 Sukoharjo. All rights reserved ©By Dani @Teknik Comp</p>
        </div>
    </footer>

    <!-- Student Info Modal -->
    <div id="student-info-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit"></i> Data Peserta Ujian</h3>
                <button class="modal-close" id="close-student-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="student-name">Nama Lengkap</label>
                    <input type="text" id="student-name" class="modal-input" placeholder="Masukkan nama lengkap" required>
                </div>
                <div class="form-group">
                    <label for="student-class">Kelas</label>
                    <select id="student-class" class="modal-input" required>
                        <option value="">Pilih Kelas</option>
                        <!-- Classes will be loaded from database -->
                    </select>
                </div>
                <p id="student-info-error" class="error-message"></p>
            </div>
            <div class="modal-footer">
                <button id="start-exam-btn" class="btn primary">Simpan Data</button>
            </div>
        </div>
    </div>

    <!-- Student Confirmation Modal -->
    <div id="student-confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-check-circle"></i> Konfirmasi Data Siswa</h3>
            </div>
            <div class="modal-body">
                <p>Harap periksa kembali data Anda:</p>
                <div class="student-confirm-info">
                    <p><strong>Nama:</strong> <span id="confirm-name"></span></p>
                    <p><strong>Kelas:</strong> <span id="confirm-class"></span></p>
                </div>
                <p class="confirmation-warning">Data ini tidak dapat diubah setelah dikonfirmasi. Pastikan data sudah benar.</p>
            </div>
            <div class="modal-footer">
                <button id="edit-data-btn" class="btn secondary">
                    <i class="fas fa-edit"></i> Edit Data
                </button>
                <button id="confirm-data-btn" class="btn primary">
                    <i class="fas fa-check"></i> Data Benar Lanjut
                </button>
            </div>
        </div>
    </div>

    <!-- App Scripts -->
    <script src="jees/config.js"></script>
    <script src="jees/app_murid.js"></script>
    <script src="jees/script.js"></script>
    <script src="jees/preview.js"></script>
    
    <!-- Loading Script -->
    <script>
        // Navigation between sections
        const tugasBtn = document.getElementById('tugas-btn');
        const materiBtn = document.getElementById('materi-btn');
        const soalBtn = document.getElementById('soal-btn');
        const tugasSection = document.getElementById('tugas-section');
        const materiSection = document.getElementById('materi-section');
        const soalSection = document.getElementById('soal-section');

        if (tugasBtn && materiBtn && soalBtn) {
            tugasBtn.addEventListener('click', () => {
                tugasSection.style.display = 'block';
                materiSection.style.display = 'none';
                soalSection.style.display = 'none';
                tugasBtn.classList.add('active');
                materiBtn.classList.remove('active');
                soalBtn.classList.remove('active');
            });

            materiBtn.addEventListener('click', () => {
                tugasSection.style.display = 'none';
                materiSection.style.display = 'block';
                soalSection.style.display = 'none';
                materiBtn.classList.add('active');
                tugasBtn.classList.remove('active');
                soalBtn.classList.remove('active');
            });

            soalBtn.addEventListener('click', () => {
                tugasSection.style.display = 'none';
                materiSection.style.display = 'none';
                soalSection.style.display = 'block';
                soalBtn.classList.add('active');
                tugasBtn.classList.remove('active');
                materiBtn.classList.remove('active');
                
                // Check if student info exists and is valid
                const studentInfo = getStudentInfo();
                if (!studentInfo || !studentInfo.name || !studentInfo.class) {
                    showStudentInfoModal();
                } else {
                    loadAvailableExams();
                }
            });
        }

        function getStudentInfo() {
            try {
                const studentInfo = JSON.parse(localStorage.getItem('studentInfo') || '{}');
                if (studentInfo && studentInfo.name && studentInfo.class) {
                    return studentInfo;
                }
                return null;
            } catch (e) {
                console.error('Error parsing student info:', e);
                return null;
            }
        }

        async function loadClasses() {
            try {
                const { data: classes, error } = await supabase
                    .from('classes')
                    .select('name')
                    .order('name', { ascending: true });
                
                if (error) throw error;
                
                const select = document.getElementById('student-class');
                if (select) {
                    select.innerHTML = '<option value="">Pilih Kelas</option>';
                    classes.forEach(cls => {
                        const option = document.createElement('option');
                        option.value = cls.name;
                        option.textContent = cls.name;
                        select.appendChild(option);
                    });
                    
                    // Pre-select if already exists in localStorage
                    const studentInfo = getStudentInfo();
                    if (studentInfo && studentInfo.class) {
                        select.value = studentInfo.class;
                    }
                }
            } catch (error) {
                console.error('Error loading classes:', error);
                showNotification('Gagal memuat daftar kelas', 'error');
            }
        }

        function showStudentInfoModal() {
            const modal = document.getElementById('student-info-modal');
            const confirmModal = document.getElementById('student-confirm-modal');
            if (!modal || !confirmModal) return;
            
            modal.style.display = 'block';
            
            // Load classes from database
            loadClasses();
            
            // Pre-fill if partial info exists
            const existingInfo = getStudentInfo() || {};
            document.getElementById('student-name').value = existingInfo.name || '';
            
            // Clear previous event listeners
            const startBtn = document.getElementById('start-exam-btn');
            startBtn.replaceWith(startBtn.cloneNode(true));
            
            document.getElementById('start-exam-btn').addEventListener('click', () => {
                const name = document.getElementById('student-name').value.trim();
                const studentClass = document.getElementById('student-class').value;
                const errorElement = document.getElementById('student-info-error');
                
                if (!name) {
                    errorElement.textContent = 'Harap isi nama lengkap';
                    return;
                }
                
                if (!studentClass) {
                    errorElement.textContent = 'Harap pilih kelas';
                    return;
                }
                
                // Show confirmation modal
                document.getElementById('confirm-name').textContent = name;
                document.getElementById('confirm-class').textContent = studentClass;
                
                // Hide the info modal temporarily
                modal.style.display = 'none';
                confirmModal.style.display = 'block';
                
                // Set up confirmation modal buttons
                document.getElementById('edit-data-btn').addEventListener('click', () => {
                    confirmModal.style.display = 'none';
                    modal.style.display = 'block';
                });
                
                document.getElementById('confirm-data-btn').addEventListener('click', () => {
                    const studentInfo = {
                        name,
                        class: studentClass
                    };
                    
                    // Save to localStorage
                    localStorage.setItem('studentInfo', JSON.stringify(studentInfo));
                    
                    // Close both modals and load exams
                    confirmModal.style.display = 'none';
                    modal.style.display = 'none';
                    loadAvailableExams();
                });
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
                if (e.target === confirmModal) {
                    confirmModal.style.display = 'none';
                    modal.style.display = 'block';
                }
            });
        }

        // Refresh materials button
        document.getElementById('refresh-materi-btn')?.addEventListener('click', () => {
            showNotification('Daftar materi diperbarui', 'success');
        });
    </script>
</body>
</html>